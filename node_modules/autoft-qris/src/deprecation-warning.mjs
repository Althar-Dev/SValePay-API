import { readFileSync } from 'fs';
import { resolve, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

class DeprecationWarning {
    static checkNodeVersion() {
        const nodeVersion = process.version;
        const currentVersion = nodeVersion.slice(1);
        const targetVersion = '21.7.3';
        
        if (currentVersion !== targetVersion) {
            console.log('\n' + '='.repeat(60));
            console.log('‚ö†Ô∏è  NODE.JS VERSION WARNING!');
            console.log('='.repeat(60));
            console.log(`üî¥ Node.js ${nodeVersion} detected`);
            console.log('‚ùå Chalk package hanya support Node.js 21.7.3');
            console.log('üìã Solusi:');
            console.log('   ‚Ä¢ Install Node.js 21.7.3 secara spesifik');
            console.log('   ‚Ä¢ Versi lain akan menyebabkan chalk error');
            console.log(`üí° Required Node.js version: ${targetVersion}`);
            console.log('='.repeat(60) + '\n');
            return false;
        }
        return true;
    }

    static async showUpdateNotification() {
        try {
            const chalk = await import('chalk');
            const packageJsonPath = resolve(__dirname, '../package.json');
            const packageData = JSON.parse(readFileSync(packageJsonPath, 'utf8'));
            const currentVersion = packageData.version;
            
            console.log('\n' + '='.repeat(60));
            console.log(chalk.default.yellow.bold('üöÄ UPDATE TERSEDIA!'));
            console.log('='.repeat(60));
            console.log(chalk.default.cyan('üì¶ Package: autoft-qris'));
            console.log(chalk.default.green(`‚ú® Versi Terbaru: v${currentVersion}`));
            console.log(chalk.default.blue('üé® Fitur Baru:'));
            console.log(chalk.default.white('   ‚Ä¢ 2 Tema QRIS (Default & Meta Style)'));
            console.log(chalk.default.white('   ‚Ä¢ ESM & CommonJS Support'));
            console.log(chalk.default.white('   ‚Ä¢ Perbaikan performa'));
            console.log(chalk.default.white('   ‚Ä¢ API yang lebih bersih'));
            console.log(chalk.default.yellow('\nüí° Untuk update:'));
            console.log(chalk.default.white('   npm update autoft-qris'));
            console.log(chalk.default.gray('\nüìñ Dokumentasi lengkap:'));
            console.log(chalk.default.blue('   https://github.com/AutoFTbot/Qris-OrderKuota'));
            console.log(chalk.default.magenta('\nüë®‚Äçüíª Original Author: AutoFTbot'));
            console.log(chalk.default.green('ü§ù Contributor: AlfiDev'));
            console.log('='.repeat(60) + '\n');
        } catch (error) {
            console.log('\n' + '='.repeat(60));
            console.log('üöÄ UPDATE TERSEDIA!');
            console.log('='.repeat(60));
            console.log('üì¶ Package: autoft-qris');
            console.log('‚ú® Versi Terbaru dengan fitur baru!');
            console.log('üé® Fitur Baru:');
            console.log('   ‚Ä¢ 2 Tema QRIS (Default & Meta Style)');
            console.log('   ‚Ä¢ ESM & CommonJS Support');
            console.log('   ‚Ä¢ Perbaikan performa');
            console.log('   ‚Ä¢ API yang lebih bersih');
            console.log('\nüí° Untuk update:');
            console.log('   npm update autoft-qris');
            console.log('\nüìñ Dokumentasi lengkap:');
            console.log('   https://github.com/AutoFTbot/Qris-OrderKuota');
            console.log('\nüë®‚Äçüíª Original Author: AutoFTbot');
            console.log('ü§ù Contributor: AlfiDev');
            console.log('='.repeat(60) + '\n');
        }
    }

    static async checkAndShowWarning() {
        try {
            if (process.env.NODE_ENV === 'production') return;
            
            if (!this.checkNodeVersion()) return;
            
            await this.showUpdateNotification();
        } catch (error) {
        }
    }
}

export function checkAndShowWarning() {
    return DeprecationWarning.checkAndShowWarning();
}

export default DeprecationWarning;